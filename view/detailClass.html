<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Kreon:wght@300;400;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../assets/css/detailClass.css" />
    <title>detail class</title>
  </head>
  <body class="m-0">
    <nav class="navbar navbar-expand-lg px-5 nav bg-body-tertiary" id="navbar">
      <div class="container-fluid px-5">
        <a
          class="text-decoration-none text-color"
          href="/home"
          id="navbarBrand"
        >
          <img
            src="/assets/image/CorePathLogo.png"
            alt=""
            width="49"
            height="49"
            class="d-inline-block align-text-center"
          />
          Core Path
        </a>
        <div id="loginButtonContainer">
          <a href="/logIn">
            <button type="button" class="btn btn-custom" id="loginButton">
              LogIn/SignIn
            </button>
          </a>
        </div>
      </div>
    </nav>

    <div class="header" id="header">
      <img
        src="/assets/image/Hiasan.png"
        alt=""
        class="d-inline-block"
        width="170"
        height="180"
        id="headerImage"
      />
      <h5 id="headerText">Hi<span></span>, mau belajar apa hari ini?</h5>
    </div>
    <br /><br /><br /><br />

    <div class="container" id="mainContainer">
      <div class="row justify-content-left mainRow ps-5" id="mainRow">
        <div class="col-2" id="sidebar">
          <div class="d-flex flex-column gap-3" id="sidebarContent"></div>
        </div>

        <div class="col-7" id="content">
          <div class="d-flex align-content-right" id="contentHeader">
            <img src="" alt="" width="110" height="110" id="contentImage" />
            <div class="ps-5" id="contentText">
              <h2 class="class-title" id="contentTitle"></h2>
              <p id="contentDescription"></p>
            </div>
          </div>
          <br /><br /><br />
          <h6 id="shortDescriptionTitle">Deskripsi Singkat Materi</h6>
          <br />
          <p class="mb-0 text-center" id="shortDescription"></p>
          <br />
          <p id="programDescription"></p>
          <ol id="programList">
            <li></li>
            <li></li>
            <li></li>
            <li></li>
          </ol>
        </div>
      </div>
    </div>
    <br /><br /><br /><br />

    <footer class="footer-custom" id="footer">
      <div
        class="d-flex flex-row justify-content-between align-items-start text-start"
        id="footerContent"
      >
        <div class="me-3 fL" id="footerLeft">
          <div class="bg-white text-color box px-2" href="#" id="navbarBrand">
            <img
              src="/assets/image/CorePathLogo.png"
              alt=""
              width="49"
              height="49"
              class="d-inline-block align-text-center"
            />
            Core Path
          </div>
          <br />
          <p class="mb-4" id="footerTitle">
            Why Choose Core Path for Your Child's Journey?
          </p>
          <p id="footerDescription">
            At Core Path, we believe that every child deserves a meaningful
            education tailored to their needs, values, and aspirations.
          </p>
        </div>

        <div class="d-flex flex-row gap-5 mt-4">
          <div class="me-3" id="footerCenter">
            <h5 id="footerMenuTitle">Menu</h5>
            <br />
            <ul class="list-unstyled" id="footerMenu">
              <li>
                <a
                  href="/home"
                  class="text-white text-decoration-none"
                  id="footerMenuItem1"
                  ><p>Home</p></a
                >
              </li>
              <li>
                <a
                  href="myCourse.html"
                  class="text-white text-decoration-none"
                  id="footerMenuItem2"
                  ><p>Course</p></a
                >
              </li>
              <li>
                <a
                  href="aboutUs.html"
                  class="text-white text-decoration-none"
                  id="footerMenuItem3"
                  ><p>About Us</p></a
                >
              </li>
            </ul>
          </div>

          <div class="" id="footerRight">
            <h5 id="footerContactTitle">Hubungi kami</h5>
            <br />
            <p id="footerEmail">
              Email:
              <a
                href="corepath.info@gmail.com"
                class="text-white text-decoration-none"
                id="footerEmailLink"
                >corepath.info@gmail.com</a
              >
            </p>
            <p id="footerPhone">
              Phone:
              <a
                href="tel:+6281234567890"
                class="text-white text-decoration-none"
                id="footerPhoneLink"
                >+62 812-3456-7890</a
              >
            </p>
            <p id="footerAddress">
              Address: Komplek A, Jalan B, Kecamatan C<br />Kabupaten D -
              Provinsi E
            </p>
          </div>
        </div>
      </div>
    </footer>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>

    <script>
      // Get the id_category from the URL
      function getCategoryIdFromUrl() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get("id_category");
      }

      // Populate content based on id_category
      function populateContent(contentTitle) {
        const contentImage = document.getElementById("contentImage");
        const contentTextTitle = document.getElementById("contentTitle");
        const contentDescription =
          document.getElementById("contentDescription");
        const shortDescription = document.getElementById("shortDescription");
        const programDescription =
          document.getElementById("programDescription");
        const programList = document.getElementById("programList");

        console.log("Updating content for:", contentTitle);

        if (contentTitle === "Quranic Lesson") {
          contentImage.src = "/assets/image/QuranicLogo.png";
          contentImage.alt = "Quranic Lesson";
          contentTextTitle.textContent = "Quranic Lesson";
          contentDescription.textContent = "Pembelajaran Al-Qur'an";
          shortDescription.textContent =
            "Mengukur Akhlak Mulia melalui Pembelajaran Quran yang Terstruktur";
          programDescription.textContent =
            "Program Quranic Lesson dirancang untuk membantu anak-anak dan remaja memahami Al-Qur'an secara mendalam. Dengan pendekatan yang interaktif dan sistematis, siswa belajar:";
          programList.innerHTML = `
            <li>Membaca Al-Qur'an dengan tajwid yang benar.</li>
            <li>Menghafal ayat-ayat suci sesuai usia dan kemampuan.</li>
            <li>Memahami makna dan pesan dalam Al-Qur'an.</li>
            <li>Kelas kami menawarkan suasana yang penuh kasih dan bimbingan yang ramah, membantu siswa memperkuat ikatan spiritual dan menerapkan nilai-nilai Quran dalam kehidupan sehari-hari.</li>
          `;
        } else if (contentTitle === "English Lesson") {
          contentImage.src = "/assets/image/EnglishLogo.png";
          contentImage.alt = "English Lesson";
          contentTextTitle.textContent = "English Lesson";
          contentDescription.textContent = "Pembelajaran Bahasa Inggris";
          shortDescription.textContent = "Bridging Faith and Language Mastery";
          programDescription.textContent =
            "Our English Quranic Studies program is uniquely designed to deepen your childâ€™s understanding of the Quran while enhancing their English proficiency. Students will:";
          programList.innerHTML = `
            <li>Learn Quranic recitation with proper tajweed.</li>
            <li>Explore Quranic meanings through English explanations.</li>
            <li>Build a strong vocabulary rooted in Islamic teachings.</li>
            <li>This program is perfect for young learners and teens who aim to strengthen their Islamic foundation while developing excellent communication skills in English.</li>
          `;
        }
      }

      // Load class details based on id_category
      async function loadClassDetails() {
        const idCategory = getCategoryIdFromUrl();
        console.log("Category ID:", idCategory);
        if (!idCategory) {
          console.error("Category ID not found in URL");
          return;
        }

        try {
          // Determine the content title based on id_category
          const contentTitle =
            idCategory === "1"
              ? "Quranic Lesson"
              : idCategory === "2"
              ? "English Lesson"
              : null;

          console.log("Content Title:", contentTitle);

          if (!contentTitle) {
            console.error("Invalid category ID");
            return;
          }

          // Populate content on the page
          populateContent(contentTitle);
        } catch (error) {
          console.error(error);
          document.querySelector("#classDetailsContainer").innerHTML =
            "<p class='text-danger'>Failed to load class details. Please try again later.</p>";
        }
      }

      // Load sidebar content
      async function loadSidebarContent() {
        const sidebarContent = document.querySelector("#sidebarContent");

        try {
          const response = await fetch("/api/classes/getAllLevel");
          if (!response.ok) throw new Error("Failed to fetch data");
          const data = await response.json();

          // Clear the container before adding new content
          sidebarContent.innerHTML = "";

          // Add the title
          const title = document.createElement("h6");
          title.className = "text-center mt-4 levelTitle";
          title.id = "bookingTitle";
          title.textContent = "Booking Placement Test";
          sidebarContent.appendChild(title);

          // Add each level as an individual card
          data.levels.forEach((item) => {
            const levelCard = document.createElement("button");
            levelCard.className =
              "card text-white level-card-custom d-flex align-items-center justify-content-center";
            levelCard.id = `levelCard-${item.level_name}`;

            const levelCardBody = document.createElement("div");
            levelCardBody.className = "card-body";
            levelCardBody.textContent = item.level_name;

            levelCard.appendChild(levelCardBody);
            sidebarContent.appendChild(levelCard);

            // Load booking cards when the level card is clicked
            levelCard.addEventListener("click", () =>
              loadBookingCards(item.id_level)
            );
            console.log("Added click listener to levelCard:", item.level_name);
          });
        } catch (error) {
          console.error(error);
          sidebarContent.innerHTML =
            '<p class="text-danger">Failed to load levels. Please try again later.</p>';
        }
      }

      // Load booking cards based on the selected level and id_category
      async function loadBookingCards(id_level) {
        const categoryId = getCategoryIdFromUrl();
        const sidebarContent = document.querySelector("#sidebarContent");

        try {
          const response = await fetch(`/api/classes/schedule/${id_level}`);
          if (!response.ok)
            throw new Error(`Failed to fetch schedule: ${response.statusText}`);

          const data = await response.json(); // Pastikan hanya membaca JSON sekali
          console.log("API Response:", data);
          console.log("Calling API with level ID:", id_level);

          const schedules = data.schedules || data; // Sesuaikan jika schedules tidak ada
          if (!schedules || schedules.length === 0) {
            console.log("No schedules found.");
            const noDataMessage = document.createElement("p");
            noDataMessage.className = "text-warning";
            noDataMessage.textContent =
              "No schedules available for this level.";
            sidebarContent.appendChild(noDataMessage);
            return;
          }

          console.log("Schedules before filter:", schedules);

          // Filter schedules berdasarkan category_id
          const filteredSchedules = schedules.filter(
            (schedule) => schedule.category_id == categoryId
          );
          console.log("Filtered schedules:", filteredSchedules);

          // Render data
          filteredSchedules.forEach((schedule) => {
            const bookingCard = document.createElement("div");
            bookingCard.className = "col mb-2";
            bookingCard.id = "bookingCard";

            const bookingCardContent = `
              <div class="col-12 justify-content-center">
                <div
                  class="card py-2 px-3 mb-3 card-custom d-flex flex-column justify-content-center gradient text-primary"
                  id="bookingCard${schedule.id_schedule}"
                >
                  <div>
                    <h6 class="card-title mb-0">${schedule.day}</h6>
                    <p class="card-text fs-6">${schedule.start_time} - ${schedule.end_time}</p>
                  </div>
                  <button
                    onclick="location.href='payment.html?id_schedule=${schedule.id_schedule}'"
                    class="btn-custom text-center text-decoration-none"
                    id="bookingButton${schedule.id_schedule}"
                  >
                    Booking
                  </button>
                </div>
              </div>`;
            bookingCard.innerHTML = bookingCardContent;
            sidebarContent.appendChild(bookingCard);
          });
        } catch (error) {
          console.error(
            `Error loading booking cards for level ${id_level}:`,
            error.message
          );
          const errorMessage = document.createElement("p");
          errorMessage.className = "text-danger";
          errorMessage.textContent =
            "Failed to load schedules. Please try again later.";
          sidebarContent.appendChild(errorMessage);
        }
      }

      // Initialize on page load
      document.addEventListener("DOMContentLoaded", () => {
        loadSidebarContent();
        loadClassDetails();
      });
    </script>
  </body>
</html>
